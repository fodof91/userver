<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../favicon.svg">
<title>userver: storages::secdist::SecdistConfig Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<link rel="stylesheet" href="../../doxygen-like.css">
<script src="../../highlight.pack.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a class="titlelink" href="../../index.html">userver
   </a>
   </div>
   <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework (beta)</a></div>
  </td>
  <td style="float: right; padding-right: 40px; padding-top: 15px;">
    <a href="https://github.com/userver-framework/userver" rel="noopener" target="_blank" class="titlelink">
      <img src="../../github_logo.svg" alt="Github"/>
    </a>
    &nbsp;
    <a href="https://t.me/+i3k5A6V0oFgwNmYy" rel="noopener" id='telegram_channel' target="_blank" class="titlelink">
      <img src="../../telegram_logo.svg" alt="Telegram"/>
    </a>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d0/d91/namespacestorages.html">storages</a></li><li class="navelem"><a class="el" href="../../d1/d49/namespacestorages_1_1secdist.html">secdist</a></li><li class="navelem"><a class="el" href="../../de/d15/classstorages_1_1secdist_1_1SecdistConfig.html">SecdistConfig</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="../../d0/d4e/classstorages_1_1secdist_1_1SecdistConfig-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">storages::secdist::SecdistConfig Class Reference<span class="mlabels"><span class="mlabel">final</span></span><div class="ingroups"><a class="el" href="../../de/d08/group__userver__clients.html">Clients</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Client to retrieve credentials from the <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a>.  
 <a href="../../de/d15/classstorages_1_1secdist_1_1SecdistConfig.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../dd/d27/secdist_8hpp_source.html">userver/storages/secdist/secdist.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../dd/d73/structstorages_1_1secdist_1_1SecdistConfig_1_1Settings.html">Settings</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa10a4f385ece0f3e06a12191bbb78b27"><td class="memItemLeft" align="right" valign="top"><a id="aa10a4f385ece0f3e06a12191bbb78b27"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>SecdistConfig</b> (const <a class="el" href="../../dd/d73/structstorages_1_1secdist_1_1SecdistConfig_1_1Settings.html">Settings</a> &amp;settings)</td></tr>
<tr class="separator:aa10a4f385ece0f3e06a12191bbb78b27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc7c911ef77af92bde011f1765d1e940"><td class="memTemplParams" colspan="2"><a id="acc7c911ef77af92bde011f1765d1e940"></a>
template&lt;typename T &gt; </td></tr>
<tr class="memitem:acc7c911ef77af92bde011f1765d1e940"><td class="memTemplItemLeft" align="right" valign="top">const T &amp;&#160;</td><td class="memTemplItemRight" valign="bottom"><b>Get</b> () const</td></tr>
<tr class="separator:acc7c911ef77af92bde011f1765d1e940"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ac7bb96acac32bf7b81f5e72b89708659"><td class="memTemplParams" colspan="2"><a id="ac7bb96acac32bf7b81f5e72b89708659"></a>
template&lt;typename T &gt; </td></tr>
<tr class="memitem:ac7bb96acac32bf7b81f5e72b89708659"><td class="memTemplItemLeft" align="right" valign="top">static std::size_t&#160;</td><td class="memTemplItemRight" valign="bottom"><b>Register</b> (std::function&lt; std::any(const <a class="el" href="../../de/d91/classformats_1_1json_1_1Value.html">formats::json::Value</a> &amp;)&gt; &amp;&amp;factory)</td></tr>
<tr class="separator:ac7bb96acac32bf7b81f5e72b89708659"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Client to retrieve credentials from the <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a>. </p>
<h2><a class="anchor" id="autotoc_md455"></a>
Example usage:</h2>
<p>Declare a type that would work with the credentials:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../dd/d27/secdist_8hpp.html" title="Client to retrieve credentials from the components::Secdist.">userver/storages/secdist/secdist.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../de/d55/algorithm_8hpp.html" title="Miscellaneous cryptographic routines.">userver/crypto/algorithm.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d3/de9/shared_2include_2userver_2formats_2parse_2common__containers_8hpp.html" title="Parsers and converters for Standard Library containers and std::optional.">userver/formats/parse/common_containers.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../db/dc2/algo_8hpp.html" title="Small useful algorithms.">userver/utils/algo.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d4/dd3/shared_2include_2userver_2utils_2strong__typedef_8hpp.html" title="Strong typedef for a type T.">userver/utils/strong_typedef.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>UserPasswords {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="keyword">using</span> Password = <a class="code" href="../../d4/d67/classutils_1_1StrongTypedef.html" title="Strong typedef for a type T.">utils::NonLoggable&lt;class PasswordTag, std::string&gt;</a>;</div>
<div class="line"> </div>
<div class="line">  UserPasswords(<span class="keyword">const</span> <a class="code" href="../../de/d91/classformats_1_1json_1_1Value.html" title="Non-mutable JSON value representation.">formats::json::Value</a>&amp; doc)</div>
<div class="line">      : user_password_(doc[<span class="stringliteral">&quot;user-passwords&quot;</span>].As&lt;Storage&gt;()) {}</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">bool</span> IsMatching(<span class="keyword">const</span> std::string&amp; user, <span class="keyword">const</span> Password&amp; password)<span class="keyword"> const </span>{</div>
<div class="line">    <span class="keyword">auto</span> ptr = <a class="code" href="../../d6/d84/namespaceutils.html#a6584be0d2316984130b2aae5c198adf3" title="Returns nullptr if no key in associative container, otherwise returns pointer to value.">utils::FindOrNullptr</a>(user_password_, user);</div>
<div class="line">    <span class="keywordflow">return</span> ptr &amp;&amp; <a class="code" href="../../dd/d0e/namespacecrypto_1_1algorithm.html#a23ab15948fb8273453bf8c3f056fa785" title="Performs constant-time string comparison if the strings are of equal size.">crypto::algorithm::AreStringsEqualConstTime</a>(</div>
<div class="line">                      ptr-&gt;GetUnderlying(), password.GetUnderlying());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <span class="keyword">using</span> Storage = std::unordered_map&lt;std::string, Password&gt;;</div>
<div class="line">  Storage user_password_;</div>
<div class="line">};</div>
</div><!-- fragment --><p> Fill the <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a> <code>config</code> from file with the secure data:</p>
<div class="fragment"><div class="line">  {</div>
<div class="line">      <span class="stringliteral">&quot;user-passwords&quot;</span>: {</div>
<div class="line">          <span class="stringliteral">&quot;username&quot;</span>: <span class="stringliteral">&quot;password&quot;</span>,</div>
<div class="line">          <span class="stringliteral">&quot;another username&quot;</span>: <span class="stringliteral">&quot;another password&quot;</span></div>
<div class="line">      }</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Retrieve <a class="el" href="../../de/d15/classstorages_1_1secdist_1_1SecdistConfig.html" title="Client to retrieve credentials from the components::Secdist.">SecdistConfig</a> from <a class="el" href="../../da/dc7/classcomponents_1_1Secdist.html" title="Component that stores security related data (keys, passwords, ...).">components::Secdist</a> and get the type from it:</p>
<div class="fragment"><div class="line">  <span class="keyword">auto</span>&amp; user_passwords = secdist_config.Get&lt;UserPasswords&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> password = UserPasswords::Password{<span class="stringliteral">&quot;password&quot;</span>};</div>
<div class="line">  EXPECT_TRUE(user_passwords.IsMatching(<span class="stringliteral">&quot;username&quot;</span>, password));</div>
<div class="line">  EXPECT_FALSE(user_passwords.IsMatching(<span class="stringliteral">&quot;username2&quot;</span>, password));</div>
</div><!-- fragment --><p> Json with secure data can also be loaded from environment variable with name defined in <code>environment_secrets_key</code>. Sample variable value: <code>{"user-passwords":{"username":"password","another username":"another password"}}</code>. It has the same format as data from file. If both sources are presented, data from environment variable will be merged with data from file (json objects will be merged, duplicate fields of other types will be overridden by data from environment variable). </p>

<p class="definition">Definition at line <a class="el" href="../../dd/d27/secdist_8hpp_source.html#l00071">71</a> of file <a class="el" href="../../dd/d27/secdist_8hpp_source.html">secdist.hpp</a>.</p>
</div><hr/>The documentation for this class was generated from the following file:<ul>
<li>userver/storages/secdist/<a class="el" href="../../dd/d27/secdist_8hpp_source.html">secdist.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
<a id='page_edit' style="float:left; padding-left: 7pt;" href="#">⚒ Редактировать страницу</a>
<address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
<script type="text/javascript">
const LOWER_CASE_TRANSLITTERATION_MAPPING = {
    "а":"a", "б":"b", "в":"v", "г":"g", "д":"d", "е":"e", "ё":"jo", "ж":"zh",
    "з":"z", "и":"i", "й":"jj", "к":"k", "л":"l", "м":"m", "н":"n", "о":"o",
    "п":"p", "р":"r", "с":"s", "т":"t", "у":"u", "ф":"f", "х":"x", "ц":"c",
    "ч":"ch", "ш":"sh", "щ":"shh", "ъ":"\'", "ы":"y", "ь":"\'", "э":"je",
    "ю":"ju", "я":"ja"
};
const DOXYGEN_DIAMOND_STRING = '◆\u00A0' // ◆&nbsp;
function make_id(raw_id) {
    return raw_id.toLowerCase().split('').map(function (char) {
        return LOWER_CASE_TRANSLITTERATION_MAPPING[char] || char;
    }).join('').replace(/\W/g, '');
}
const html_escape = function () {
    const p = document.createElement('p');
    return function (text) {
        p.textContent = text;
        return p.innerHTML;
    };
}();
function setup_page_edit() {
    let href = window.location.href;
    const idx = href.indexOf('md_ru_');
    if (idx === -1) {
        $('#page_edit').hide();
        return;
    }
    href = href.substring(idx).split('.html')[0];
    href = href.split('#')[0];
    href = href.replace('md_ru_', 'https://wiki.yandex-team.ru/taxi/backend/');
    href = href.replaceAll('_', '/');
    $('#page_edit').attr("href", href + '/.edit');
}
function draw_toc() {
    let headers = $(':header');
    if (headers.length === 0) {
        return;
    }
    let sidenav_content = '<div id="mySidenav" class="sidenav">';
    sidenav_content += '<h2>Table of contents</h2>';
    headers.each(function() {
        let index = parseInt(this.nodeName.substring(1)) - 1;
        const header = $(this);
        let id = header.attr('id');
        if (!id) {
          id = make_id(header.text())
          header.attr('id', id);
        }
        let header_text = header.text()
        if (header_text.startsWith(DOXYGEN_DIAMOND_STRING)) {
            ++index;
            header_text = header_text.substring(DOXYGEN_DIAMOND_STRING.length);
        }
        sidenav_content += ''
          + '<a href="#' + id + '" style="padding-left: ' + index * 15 + 'px">'
          + '•&nbsp;' + html_escape(header_text)
          + '</a>'
        ;
        header.append(' <a class="hoverlink" href="#' + id + '">🔗</a>')
    });
    sidenav_content += '</div>';
    $(sidenav_content).insertAfter('.header');
}
function highlight_code() {
    if (window.location.href.indexOf("pp_source") !== -1
        || window.location.href.indexOf("cpp-example") !== -1) {
        // Header listing is already nicely highlighted by Doxygen
        return;
    }
    hljs.configure({
        tabReplace: '    ' // 4 spaces
    });
    hljs.registerAliases('py', {languageName: 'python'});
    hljs.registerAliases('sh', {languageName: 'shell'});
    hljs.registerAliases('bash', {languageName: 'shell'});
    hljs.registerAliases('yml', {languageName: 'yaml'});
    hljs.registerAliases('plain', {languageName: 'plaintext'});
    hljs.registerAliases('tskv', {languageName: 'plaintext'});
    $(".fragment").each(function() {
        const node = $(this);
        let data = '';
        let language = '';
        let requires_higlighting = true;
        node.children('div.line').each(function(i) {
            line = $(this).text();
            // Doxygen 1.8.11 workaround to remove line numbers.
            // No line numbers added in Doxygen 1.8.13
            line = line.replace(/^ *\d+\xA0/, '');
            if (i === 0) {
                line = line.trimLeft().replace(/^# /, '');
                if (line === 'autodetect') {
                    return true;
                } else if (hljs.getLanguage(line)) {
                    language = line;
                    return true;
                } else {
                    requires_higlighting = false;
                    return false;
                }
            }
            data += line + '\n';
        });
        if (requires_higlighting === false) {
            return;
        }
        if (language !== '') {
            data = hljs.highlight(language, data).value;
        } else {
            data = hljs.highlightAuto(data).value;
        }
        node.replaceWith('<div class="fragment"><pre>' + data + '</pre></div>');
    });
}
function setup_if_landing() {
    if (document.getElementById('landing_logo_id') === null) {
        return false;
    }
    $('#titlearea').hide();
    const main_nav = $('#main-nav')
    main_nav.addClass('main-nav-landing');
    main_nav.append('<hr>');
    $('.header').hide();
    $('body').css('background-color', 'black');
    $('#page_edit').hide();
    return true;
}
function sticky_menu() {
    const main_nav = $('#main-nav');
    const menu_y_position = 94;
    const search_results_window = $('#MSearchResultsWindow');
    var menu_is_sticky = false;
    const stick = function () {
        if ($(this).scrollTop() > menu_y_position) {
            if (menu_is_sticky) return;
            search_results_window.addClass('stickySearchResults');
            main_nav.addClass('stickyHeader');
            menu_is_sticky = true;
        } else {
            if (!menu_is_sticky) return;
            search_results_window.removeClass('stickySearchResults');
            // 'top' property of the results window is computed by Doxygen JS
            // and it may give bad results if the computation is invoked at the
            // middle of the page.
            //
            // Hiding the window. Doxygen will recompute and show it on new
            // user input.
            search_results_window.hide();
            main_nav.removeClass('stickyHeader');
            menu_is_sticky = false;
        }
    };
    stick();  // on page refresh draw the menu on a right position
    $(window).on("scroll", stick);
}
function telegram_channel_language() {
  if (/^ru/.test(navigator.language)) {
    const channel = $('#telegram_channel');
    if (channel) {
      channel.attr('href', 'https://t.me/+AdadhDPVG5xhNWRi');
    }
  }
}
$(function() {
    if (setup_if_landing()) return;
    draw_toc();
    highlight_code();
    setup_page_edit();
    telegram_channel_language();
    sticky_menu();
});
</script>
</body>
</html>
