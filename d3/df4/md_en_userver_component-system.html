<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../favicon.svg">
<title>userver: Component system</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<link rel="stylesheet" href="../../doxygen-like.css">
<script src="../../highlight.pack.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a class="titlelink" href="../../index.html">userver
   </a>
   </div>
   <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework (beta)</a></div>
  </td>
  <td style="float: right; padding-right: 40px; padding-top: 15px;">
    <a href="https://github.com/userver-framework/userver" rel="noopener" target="_blank" class="titlelink">
      <img src="../../github_logo.svg" alt="Github"/>
    </a>
    &nbsp;
    <a href="https://t.me/+i3k5A6V0oFgwNmYy" rel="noopener" id='telegram_channel' target="_blank" class="titlelink">
      <img src="../../telegram_logo.svg" alt="Telegram"/>
    </a>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Component system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Any userver-based service consists of components. A component is a basic building block that encapsulates dependencies logic with configuration and is able to interact with other components.</p>
<p>Only components should know about components. Clients and other types constructed by components should not use <a class="el" href="../../db/dff/classcomponents_1_1ComponentConfig.html">components::ComponentConfig</a>, <a class="el" href="../../da/db1/classcomponents_1_1ComponentContext.html" title="Class to retrieve other components.">components::ComponentContext</a>, or components directly. All the components should inherit from <a class="el" href="../../d5/d69/classcomponents_1_1LoggableComponentBase.html" title="Base class for all application components, it depends on components::Logger and components::Tracer.">components::LoggableComponentBase</a> base class and may override its methods.</p>
<p>All the components are listed at the <a class="el" href="../../dd/d1c/group__userver__components.html">Components</a> API Group.</p>
<h1><a class="anchor" id="autotoc_md77"></a>
Components static configuration</h1>
<p><a class="el" href="../../dc/d21/classcomponents_1_1ManagerControllerComponent.html" title="Component that prepares the engine internals and starts all the other components.">components::ManagerControllerComponent</a> configures the engine internals from information provided in its static config: preallocates coroutines, creates the engine::TaskProcessor, creates threads for low-level event processing. After that it starts all the components that were added to the <a class="el" href="../../dc/df0/classcomponents_1_1ComponentList.html" title="A list to keep a unique list of components to start with components::Run(), utils::DaemonMain() or co...">components::ComponentList</a>. Each registered component should have a section in service config (also known as static config).</p>
<p>The component configuration is passed as a first parameter of type <a class="el" href="../../db/dff/classcomponents_1_1ComponentConfig.html">components::ComponentConfig</a> to the constructor of the component. Note that <a class="el" href="../../db/dff/classcomponents_1_1ComponentConfig.html">components::ComponentConfig</a> extends the functionality of <a class="el" href="../../d3/d6c/classyaml__config_1_1YamlConfig.html" title="Datatype that represents YAML with substituted variables.">yaml_config::YamlConfig</a> that is able to substitute variables with values, use fallbacks. See <a class="el" href="../../d3/d6c/classyaml__config_1_1YamlConfig.html" title="Datatype that represents YAML with substituted variables.">yaml_config::YamlConfig</a> for more info and examples.</p>
<p>All the components have the following options:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name </th><th class="markdownTableHeadNone">Description </th><th class="markdownTableHeadNone">Default value  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">load-enabled </td><td class="markdownTableBodyNone">set to <code>false</code> to disable loading of the component </td><td class="markdownTableBodyNone">true  </td></tr>
</table>
<p><a class="anchor" id="static-configs-validation"></a></p>
<h2><a class="anchor" id="autotoc_md78"></a>
Static configs validation</h2>
<p>To validate static configs, define member function of your component <code>GetStaticConfigSchema()</code> and specialize variable <code><a class="el" href="../../d0/d1f/namespacecomponents.html#a6449aa8d70e696bcd34f8cf75798c7a4">components::kHasValidate</a></code></p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>myservice::smth {</div>
<div class="line"> </div>
<div class="line"><a class="code" href="../../d1/d3e/structyaml__config_1_1Schema.html" title="JSON Schema-like type definition.">yaml_config::Schema</a> Component::GetStaticConfigSchema() {</div>
<div class="line">  <span class="keywordflow">return</span> yaml_config::MergeSchemas&lt;components::LoggableComponentBase&gt;(R<span class="stringliteral">&quot;(</span></div>
<div class="line"><span class="stringliteral">type: object</span></div>
<div class="line"><span class="stringliteral">description: user component smth</span></div>
<div class="line"><span class="stringliteral">additionalProperties: false</span></div>
<div class="line"><span class="stringliteral">properties:</span></div>
<div class="line"><span class="stringliteral">    some-url:</span></div>
<div class="line"><span class="stringliteral">        type: string</span></div>
<div class="line"><span class="stringliteral">        description: url for something</span></div>
<div class="line"><span class="stringliteral">)&quot;);</span></div>
<div class="line"><span class="stringliteral">}</span></div>
<div class="line"><span class="stringliteral"></span> </div>
<div class="line"><span class="stringliteral">}  </span><span class="comment">// namespace myservice::smth</span></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keyword">inline</span> constexpr <span class="keywordtype">bool</span> components::kHasValidate&lt;myservice::smth::Component&gt; =</div>
<div class="line">    <span class="keyword">true</span>;</div>
</div><!-- fragment --><p> All schemas and sub-schemas must have <code>description</code> field and can have <code>defaultDescription</code> field if they have a default value. </p><dl class="section note"><dt>Note</dt><dd>There are plans to use it to generate documentation.</dd></dl>
<p>Supported types:</p><ul>
<li>Scalars: <code>boolean</code>, <code>string</code>, <code>integer</code>, <code>double</code></li>
<li><code>object</code> must have options <code>additionalProperties</code> and <code>properties</code></li>
<li><code>array</code> must have option <code>items</code></li>
</ul>
<h1><a class="anchor" id="autotoc_md79"></a>
Startup context</h1>
<p>On component construction a <a class="el" href="../../da/db1/classcomponents_1_1ComponentContext.html" title="Class to retrieve other components.">components::ComponentContext</a> is passed as a second parameter to the constructor of the component. That context could be used to get references to other components. That reference to the component is guaranteed to outlive the component that is being constructed.</p>
<h1><a class="anchor" id="autotoc_md80"></a>
Components construction order</h1>
<p><a class="el" href="../../d6/d84/namespaceutils.html#a40294f3ed93c7f13cb2c814d70134820">utils::DaemonMain</a>, <a class="el" href="../../d0/d1f/namespacecomponents.html#a17ac62098291e106b4ddad40a8cc179e">components::Run</a> or <a class="el" href="../../d0/d1f/namespacecomponents.html#a1bbc0de4bbd8399a1c3d1801a8bfeb17">components::RunOnce</a> start all the components from the passed <a class="el" href="../../dc/df0/classcomponents_1_1ComponentList.html" title="A list to keep a unique list of components to start with components::Run(), utils::DaemonMain() or co...">components::ComponentList</a>. Each component is constructed in a separate <a class="el" href="../../d8/d7c/classengine_1_1Task.html" title="Asynchronous task.">engine::Task</a> which makes them initialize concurrently. This is a useful feature, for examples in cases with multiple caches that slowly read from different databases.</p>
<p>To make component <em>A</em> depend on component <em>B</em> just call <a class="el" href="../../da/db1/classcomponents_1_1ComponentContext.html#a4ba6078e836fc718192a75444f93f9f3" title="Finds a component of type T with specified name (if any) and returns the component after it was initi...">components::ComponentContext::FindComponent&lt;B&gt;()</a> in the constructor of A. FindComponent() suspends the current task and continues only after the construction of component B is finished. Components are destroyed in reverse order of construction, so the component A is destroyed before the component B. In other words - references from FindComponent() outlive the component that called the FindComponent() function. If any component loading fails, FindComponent() wakes up and throws an <a class="el" href="../../d2/d43/classcomponents_1_1ComponentsLoadCancelledException.html" title="Exception that is thrown from components::ComponentContext::FindComponent() if a component load faile...">components::ComponentsLoadCancelledException</a>.</p>
<h1><a class="anchor" id="autotoc_md81"></a>
References from components</h1>
<p>It is a common practice to have a component that returns reference <em>R</em> from some function <em>F</em>. In such cases:</p><ul>
<li>a reference <em>R</em> lives as long as the component is alive</li>
<li>a reference <em>R</em> is usually a client</li>
<li>and it is safe to invoke member functions of reference <em>R</em> concurrently unless otherwise specified.</li>
</ul>
<p>Examples:</p><ul>
<li>components::HttpClient::GetHttpClient()</li>
<li>components::StatisticsStorage::GetStorage()</li>
</ul>
<h1><a class="anchor" id="autotoc_md82"></a>
Writing your own components</h1>
<p>Users of the framework may (and should) write their own components.</p>
<p>Components provide functionality to tie the main part of the program with the configuration and other components. Component should be lightweight and simple.</p>
<dl class="section note"><dt>Note</dt><dd>Rule of a thumb: if you wish to unit test some code that is located in the component, then in 99% of cases that code should not be located in the component.</dd></dl>
<h2><a class="anchor" id="autotoc_md83"></a>
Should I write a new component or class would be enough?</h2>
<p>You need a component if:</p><ul>
<li>you need a static config</li>
<li>you need to work with other components</li>
<li>you are writing clients (you need a component to be the factory for your clients)</li>
<li>you want to subscribe for configs or cache changes</li>
</ul>
<h2><a class="anchor" id="autotoc_md84"></a>
HowTo</h2>
<p>Start writing your component from adding a header file with a class inherited from <a class="el" href="../../d5/d69/classcomponents_1_1LoggableComponentBase.html" title="Base class for all application components, it depends on components::Logger and components::Tracer.">components::LoggableComponentBase</a>. </p><div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../da/d11/loggable__component__base_8hpp.html" title="Contains components::LoggableComponentBase declaration and forward declarations of components::Compon...">userver/components/loggable_component_base.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d6/dee/dynamic__config_2source_8hpp.html" title="A client for easy dynamic config fetching in components.">userver/dynamic_config/source.hpp</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>myservice::smth {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Component final : <span class="keyword">public</span> <a class="code" href="../../d5/d69/classcomponents_1_1LoggableComponentBase.html" title="Base class for all application components, it depends on components::Logger and components::Tracer.">components::LoggableComponentBase</a> {</div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">// name of your component to refer in static config</span></div>
<div class="line">  <span class="keyword">static</span> constexpr <span class="keyword">auto</span> kName = <span class="stringliteral">&quot;smth&quot;</span>;</div>
<div class="line"> </div>
<div class="line">  Component(<span class="keyword">const</span> <a class="code" href="../../db/dff/classcomponents_1_1ComponentConfig.html">components::ComponentConfig</a>&amp; config,</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="../../da/db1/classcomponents_1_1ComponentContext.html" title="Class to retrieve other components.">components::ComponentContext</a>&amp; context);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> DoSomething() <span class="keyword">const</span>;</div>
<div class="line"> </div>
<div class="line">  ~Component();</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <a class="code" href="../../d1/d3e/structyaml__config_1_1Schema.html" title="JSON Schema-like type definition.">yaml_config::Schema</a> GetStaticConfigSchema();</div>
<div class="line"> </div>
<div class="line"> <span class="keyword">private</span>:</div>
<div class="line">  <a class="code" href="../../d1/d22/classdynamic__config_1_1Source.html" title="A client for easy dynamic config fetching in components.">dynamic_config::Source</a> config_;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace myservice::smth</span></div>
<div class="line"> </div>
</div><!-- fragment --><p> In source file write the implementation of the component: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d8/d2e/core_2include_2userver_2components_2component_8hpp.html" title="Convinience header that provides all the types for component implementation (components::ComponentCon...">userver/components/component.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="../../d2/d88/core_2include_2userver_2dynamic__config_2storage_2component_8hpp.html" title="Component that stores the runtime config.">userver/dynamic_config/storage/component.hpp</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;userver/dynamic_config/value.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;userver/yaml_config/merge_schemas.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>myservice::smth {</div>
<div class="line"> </div>
<div class="line">Component::Component(<span class="keyword">const</span> <a class="code" href="../../db/dff/classcomponents_1_1ComponentConfig.html">components::ComponentConfig</a>&amp; config,</div>
<div class="line">                     <span class="keyword">const</span> <a class="code" href="../../da/db1/classcomponents_1_1ComponentContext.html" title="Class to retrieve other components.">components::ComponentContext</a>&amp; context)</div>
<div class="line">    : <a class="code" href="../../d0/d1f/namespacecomponents.html" title="Contains functions and types to start a userver based service/tool.">components</a>::LoggableComponentBase(config, context),</div>
<div class="line">      config_(</div>
<div class="line">          <span class="comment">// searching for some component to initialize members</span></div>
<div class="line">          context</div>
<div class="line">              .FindComponent&lt;<a class="code" href="../../d0/d1f/namespacecomponents.html" title="Contains functions and types to start a userver based service/tool.">components</a>::DynamicConfig&gt;()</div>
<div class="line">              <span class="comment">// getting &quot;client&quot; from a component</span></div>
<div class="line">              .GetSource()) {</div>
<div class="line">  <span class="comment">// Reading config values from static config</span></div>
<div class="line">  [[maybe_unused]] <span class="keyword">auto</span> url = config[<span class="stringliteral">&quot;some-url&quot;</span>].<a class="code" href="../../d3/d6c/classyaml__config_1_1YamlConfig.html#a647e4939a17d7f85c22cadfbfd7906b5" title="Returns value of *this converted to T.">As</a>&lt;std::string&gt;();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace myservice::smth</span></div>
</div><!-- fragment --><p>Destructor of the component is invoked on service shutdown. Components are destroyed in the reverse order of construction. In other words, references from <code>context.FindComponent&lt;<a class="el" href="../../dd/d1a/classcomponents_1_1DynamicConfig.html" title="Component that stores the runtime config.">components::DynamicConfig</a>&gt;()</code> outlive the component.</p>
<p>If you need dynamic configs, you can get them using this approach: </p><div class="fragment"><div class="line"><span class="keyword">namespace </span>myservice::smth {</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"><span class="keywordtype">int</span> ParseRuntimeCfg(<span class="keyword">const</span> <a class="code" href="../../d0/d0a/classdynamic__config_1_1DocsMap.html">dynamic_config::DocsMap</a>&amp; docs_map) {</div>
<div class="line">  <span class="keywordflow">return</span> docs_map.Get(<span class="stringliteral">&quot;SAMPLE_INTEGER_FROM_RUNTIME_CONFIG&quot;</span>).<a class="code" href="../../de/d91/classformats_1_1json_1_1Value.html#a4383138b64646d372ab3990e38e2fc62" title="Returns value of *this converted to T.">As</a>&lt;<span class="keywordtype">int</span>&gt;();</div>
<div class="line">}</div>
<div class="line">constexpr <a class="code" href="../../dc/d03/structdynamic__config_1_1Key.html" title="A config key is a unique identifier for a config variable.">dynamic_config::Key&lt;ParseRuntimeCfg&gt;</a> kMyConfig{};</div>
<div class="line">}  <span class="comment">// namespace</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> Component::DoSomething()<span class="keyword"> const </span>{</div>
<div class="line">  <span class="comment">// Getting a snapsot of runtime config.</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keyword">auto</span> runtime_config = config_.GetSnapshot();</div>
<div class="line">  <span class="keywordflow">return</span> runtime_config[kMyConfig];</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">}  <span class="comment">// namespace myservice::smth</span></div>
</div><!-- fragment --> <dl class="section note"><dt>Note</dt><dd>See <a class="el" href="../../dd/d69/md_en_userver_tutorial_config_service.html">Writing your own configs server</a> for info on how to implement your own config server.</dd></dl>
<p>Do not forget to register your component in <a class="el" href="../../dc/df0/classcomponents_1_1ComponentList.html" title="A list to keep a unique list of components to start with components::Run(), utils::DaemonMain() or co...">components::ComponentList</a> before invoking the <a class="el" href="../../d6/d84/namespaceutils.html#a40294f3ed93c7f13cb2c814d70134820">utils::DaemonMain</a>, <a class="el" href="../../d0/d1f/namespacecomponents.html#a17ac62098291e106b4ddad40a8cc179e">components::Run</a> or <a class="el" href="../../d0/d1f/namespacecomponents.html#a1bbc0de4bbd8399a1c3d1801a8bfeb17">components::RunOnce</a>.</p>
<p>Done! You've implemented your first component. Full sources:</p><ul>
<li><a class="el" href="../../dd/d4b/components_2component_sample_test_8hpp-example.html">components/component_sample_test.hpp</a></li>
<li><a class="el" href="../../d3/d25/components_2component_sample_test_8cpp-example.html">components/component_sample_test.cpp</a></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>For info on writing HTTP handler components refer to the <a class="el" href="../../d9/d72/md_en_userver_tutorial_hello_service.html">Writing your first HTTP server</a>.</dd></dl>
<h2><a class="anchor" id="autotoc_md85"></a>
Testing</h2>
<p>Starting up the components in unit tests is quite hard. Prefer moving out all the functionality from the component or testing the component with the help of <a class="el" href="../../d1/dd6/md_en_userver_functional_testing.html">testsuite functional tests</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
<a id='page_edit' style="float:left; padding-left: 7pt;" href="#">⚒ Редактировать страницу</a>
<address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
<script type="text/javascript">
const LOWER_CASE_TRANSLITTERATION_MAPPING = {
    "а":"a", "б":"b", "в":"v", "г":"g", "д":"d", "е":"e", "ё":"jo", "ж":"zh",
    "з":"z", "и":"i", "й":"jj", "к":"k", "л":"l", "м":"m", "н":"n", "о":"o",
    "п":"p", "р":"r", "с":"s", "т":"t", "у":"u", "ф":"f", "х":"x", "ц":"c",
    "ч":"ch", "ш":"sh", "щ":"shh", "ъ":"\'", "ы":"y", "ь":"\'", "э":"je",
    "ю":"ju", "я":"ja"
};
const DOXYGEN_DIAMOND_STRING = '◆\u00A0' // ◆&nbsp;
function make_id(raw_id) {
    return raw_id.toLowerCase().split('').map(function (char) {
        return LOWER_CASE_TRANSLITTERATION_MAPPING[char] || char;
    }).join('').replace(/\W/g, '');
}
const html_escape = function () {
    const p = document.createElement('p');
    return function (text) {
        p.textContent = text;
        return p.innerHTML;
    };
}();
function setup_page_edit() {
    let href = window.location.href;
    const idx = href.indexOf('md_ru_');
    if (idx === -1) {
        $('#page_edit').hide();
        return;
    }
    href = href.substring(idx).split('.html')[0];
    href = href.split('#')[0];
    href = href.replace('md_ru_', 'https://wiki.yandex-team.ru/taxi/backend/');
    href = href.replaceAll('_', '/');
    $('#page_edit').attr("href", href + '/.edit');
}
function draw_toc() {
    let headers = $(':header');
    if (headers.length === 0) {
        return;
    }
    let sidenav_content = '<div id="mySidenav" class="sidenav">';
    sidenav_content += '<h2>Table of contents</h2>';
    headers.each(function() {
        let index = parseInt(this.nodeName.substring(1)) - 1;
        const header = $(this);
        let id = header.attr('id');
        if (!id) {
          id = make_id(header.text())
          header.attr('id', id);
        }
        let header_text = header.text()
        if (header_text.startsWith(DOXYGEN_DIAMOND_STRING)) {
            ++index;
            header_text = header_text.substring(DOXYGEN_DIAMOND_STRING.length);
        }
        sidenav_content += ''
          + '<a href="#' + id + '" style="padding-left: ' + index * 15 + 'px">'
          + '•&nbsp;' + html_escape(header_text)
          + '</a>'
        ;
        header.append(' <a class="hoverlink" href="#' + id + '">🔗</a>')
    });
    sidenav_content += '</div>';
    $(sidenav_content).insertAfter('.header');
}
function highlight_code() {
    if (window.location.href.indexOf("pp_source") !== -1
        || window.location.href.indexOf("cpp-example") !== -1) {
        // Header listing is already nicely highlighted by Doxygen
        return;
    }
    hljs.configure({
        tabReplace: '    ' // 4 spaces
    });
    hljs.registerAliases('py', {languageName: 'python'});
    hljs.registerAliases('sh', {languageName: 'shell'});
    hljs.registerAliases('bash', {languageName: 'shell'});
    hljs.registerAliases('yml', {languageName: 'yaml'});
    hljs.registerAliases('plain', {languageName: 'plaintext'});
    hljs.registerAliases('tskv', {languageName: 'plaintext'});
    $(".fragment").each(function() {
        const node = $(this);
        let data = '';
        let language = '';
        let requires_higlighting = true;
        node.children('div.line').each(function(i) {
            line = $(this).text();
            // Doxygen 1.8.11 workaround to remove line numbers.
            // No line numbers added in Doxygen 1.8.13
            line = line.replace(/^ *\d+\xA0/, '');
            if (i === 0) {
                line = line.trimLeft().replace(/^# /, '');
                if (line === 'autodetect') {
                    return true;
                } else if (hljs.getLanguage(line)) {
                    language = line;
                    return true;
                } else {
                    requires_higlighting = false;
                    return false;
                }
            }
            data += line + '\n';
        });
        if (requires_higlighting === false) {
            return;
        }
        if (language !== '') {
            data = hljs.highlight(language, data).value;
        } else {
            data = hljs.highlightAuto(data).value;
        }
        node.replaceWith('<div class="fragment"><pre>' + data + '</pre></div>');
    });
}
function setup_if_landing() {
    if (document.getElementById('landing_logo_id') === null) {
        return false;
    }
    $('#titlearea').hide();
    const main_nav = $('#main-nav')
    main_nav.addClass('main-nav-landing');
    main_nav.append('<hr>');
    $('.header').hide();
    $('body').css('background-color', 'black');
    $('#page_edit').hide();
    return true;
}
function sticky_menu() {
    const main_nav = $('#main-nav');
    const menu_y_position = 94;
    const search_results_window = $('#MSearchResultsWindow');
    var menu_is_sticky = false;
    const stick = function () {
        if ($(this).scrollTop() > menu_y_position) {
            if (menu_is_sticky) return;
            search_results_window.addClass('stickySearchResults');
            main_nav.addClass('stickyHeader');
            menu_is_sticky = true;
        } else {
            if (!menu_is_sticky) return;
            search_results_window.removeClass('stickySearchResults');
            // 'top' property of the results window is computed by Doxygen JS
            // and it may give bad results if the computation is invoked at the
            // middle of the page.
            //
            // Hiding the window. Doxygen will recompute and show it on new
            // user input.
            search_results_window.hide();
            main_nav.removeClass('stickyHeader');
            menu_is_sticky = false;
        }
    };
    stick();  // on page refresh draw the menu on a right position
    $(window).on("scroll", stick);
}
function telegram_channel_language() {
  if (/^ru/.test(navigator.language)) {
    const channel = $('#telegram_channel');
    if (channel) {
      channel.attr('href', 'https://t.me/+AdadhDPVG5xhNWRi');
    }
  }
}
$(function() {
    if (setup_if_landing()) return;
    draw_toc();
    highlight_code();
    setup_page_edit();
    telegram_channel_language();
    sticky_menu();
});
</script>
</body>
</html>
