<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link rel="icon" href="../../favicon.svg">
<title>userver: MongoDB</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<link rel="stylesheet" href="../../doxygen-like.css">
<script src="../../highlight.pack.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0" style="width: 100%;">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a class="titlelink" href="../../index.html">userver
   </a>
   </div>
   <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework (beta)</a></div>
  </td>
  <td style="float: right; padding-right: 40px; padding-top: 15px;">
    <a href="https://github.com/userver-framework/userver" rel="noopener" target="_blank" class="titlelink">
      <img src="../../github_logo.svg" alt="Github"/>
    </a>
    &nbsp;
    <a href="https://t.me/+i3k5A6V0oFgwNmYy" rel="noopener" id='telegram_channel' target="_blank" class="titlelink">
      <img src="../../telegram_logo.svg" alt="Telegram"/>
    </a>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">MongoDB </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The mongo asynchronous driver provides an interface to work with MongoDB databases and the BSON format.</p>
<h1><a class="anchor" id="autotoc_md183"></a>
Main features</h1>
<ul>
<li>Building and reading BSON documents with support for most of the C++ types;</li>
<li>Support for basic operations with collections via <a class="el" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>;</li>
<li>Support for bulk operations;</li>
<li>Dynamic management of database sets;</li>
<li>Aggregation support.</li>
</ul>
<h1><a class="anchor" id="autotoc_md184"></a>
Metrics</h1>
<p>Most important ones:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Metric name </th><th class="markdownTableHeadNone">Description  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.pool.current-size </td><td class="markdownTableBodyNone">current number of open connections  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.pool.max-size </td><td class="markdownTableBodyNone">limit on the number of open connections  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.pool.overloads </td><td class="markdownTableBodyNone">counter of requests that could not get a connection  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.pool.queue-wait-timings </td><td class="markdownTableBodyNone">waiting timings in the queue to receive a connection  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.pool.conn-request-timings </td><td class="markdownTableBodyNone">connection receipt timings (includes queue-wait)  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.pool.conn-created/closed </td><td class="markdownTableBodyNone">open/closed connection counters  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.success </td><td class="markdownTableBodyNone">counter of successfully executed requests  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">mongo.errors </td><td class="markdownTableBodyNone">counter of failed requests  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">mongo.timings </td><td class="markdownTableBodyNone">query timings  </td></tr>
</table>
<p>See <a class="el" href="../../d6/dba/md_en_userver_service-monitor.html">Service statistics</a> for info on how to get the metrics.</p>
<h1><a class="anchor" id="autotoc_md185"></a>
Usage</h1>
<p>To use MongoDB you have to add the component <a class="el" href="../../d0/dda/classcomponents_1_1Mongo.html" title="MongoDB client component.">components::Mongo</a> and configure it according to the documentation. After that you can work with a collection via <a class="el" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> SampleMongoPool(<a class="code" href="../../d6/d08/classstorages_1_1mongo_1_1Pool.html" title="MongoDB client pool.">storages::mongo::Pool</a> pool) {</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a9037c8402aa532f2c93c89d1e9f573ab" title="Constructs an array Value from provided element list.">formats::bson::MakeArray</a>;</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> in_coll = pool.<a class="code" href="../../d6/d08/classstorages_1_1mongo_1_1Pool.html#ab6378d692e4c3ffa74715dfeff4e362b" title="Returns a handle for the specified collection.">GetCollection</a>(<span class="stringliteral">&quot;aggregate_in&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  in_coll.<a class="code" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html#a11d9b53b7cda2261c9c2ab0a5cbe4b39" title="Inserts multiple documents into the collection.">InsertMany</a>({</div>
<div class="line">      <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 1, <span class="stringliteral">&quot;x&quot;</span>, 0),</div>
<div class="line">      <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 2, <span class="stringliteral">&quot;x&quot;</span>, 1),</div>
<div class="line">      <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 3, <span class="stringliteral">&quot;x&quot;</span>, 2),</div>
<div class="line">  });</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> cursor = in_coll.Aggregate(</div>
<div class="line">      <a class="code" href="../../d3/dcb/group__userver__formats.html#gafc1e568ca1efc4014483f1bf319e105d">MakeArray</a>(<a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$match&quot;</span>, <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$gte&quot;</span>, 2))),</div>
<div class="line">                <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$addFields&quot;</span>, <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;check&quot;</span>, <span class="keyword">true</span>)),</div>
<div class="line">                <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$out&quot;</span>, <span class="stringliteral">&quot;aggregate_out&quot;</span>)),</div>
<div class="line">      <a class="code" href="../../dc/db5/classstorages_1_1mongo_1_1options_1_1ReadPreference.html#a86019ac0c8a7460ec91efa8641ebf470a275ad47b1408ba162fad465ea36e6bb8" title="read from secondary if available, fallback to primary">storages::mongo::options::ReadPreference::kSecondaryPreferred</a>,</div>
<div class="line">      <a class="code" href="../../d6/d38/classstorages_1_1mongo_1_1options_1_1WriteConcern.html#af85ddf2e778bc88f5ba462beaf1cfc75ab348f82d5527d54854937d056744d39d" title="Wait until propagation to a &quot;majority&quot; of RS nodes.">storages::mongo::options::WriteConcern::kMajority</a>);</div>
<div class="line">  EXPECT_FALSE(cursor);</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">auto</span> out_coll = pool.<a class="code" href="../../d6/d08/classstorages_1_1mongo_1_1Pool.html#ab6378d692e4c3ffa74715dfeff4e362b" title="Returns a handle for the specified collection.">GetCollection</a>(<span class="stringliteral">&quot;aggregate_out&quot;</span>);</div>
<div class="line">  EXPECT_EQ(2, out_coll.CountApprox());</div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; doc : out_coll.Find({})) {</div>
<div class="line">    EXPECT_EQ(doc[<span class="stringliteral">&quot;_id&quot;</span>].As&lt;int&gt;(), doc[<span class="stringliteral">&quot;x&quot;</span>].As&lt;int&gt;() + 1);</div>
<div class="line">    EXPECT_TRUE(doc[<span class="stringliteral">&quot;check&quot;</span>].As&lt;bool&gt;());</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Methods and options correspond to <a href="https://docs.mongodb.com/manual/reference/method/#collection">the standard MongoDB Collections API</a>.</p>
<h2><a class="anchor" id="autotoc_md186"></a>
Timeouts</h2>
<p>It is recommended to set timeouts on the server side using <a class="el" href="../../d0/db6/classstorages_1_1mongo_1_1options_1_1MaxServerTime.html" title="Specifies the server-side time limit for the operation.">storages::mongo::options::MaxServerTime</a> as for other cancellation mechanisms MongoDB does not guarantee that the cancelled operation was not applied.</p>
<p>To interrupt a request on the client side, you can use <a class="el" href="../../d2/d54/md_en_userver_intro.html#task_cancellation_intro">cancellation mechanism</a> to cancel the task that executes the Mongo request, but this leads to reopening of the connection (and possibly to errors in the logs). On the server side, the operation is not interrupted.</p>
<h2><a class="anchor" id="autotoc_md187"></a>
Write results</h2>
<p>Methods that modify a collection return an object <a class="el" href="../../d3/dc9/classstorages_1_1mongo_1_1WriteResult.html" title="MongoDB write operation result.">storages::mongo::WriteResult</a> containing information about the result of the operation:</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UpdateOneDoc(<a class="code" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>&amp; coll) {</div>
<div class="line">  <span class="keyword">using</span> <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">formats::bson::MakeDoc</a>;</div>
<div class="line">  <span class="keyword">auto</span> result =</div>
<div class="line">      coll.<a class="code" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html#abaa7f51f342d3f26e598491ca86d7717" title="Updates a single matching document.">UpdateOne</a>(<a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;_id&quot;</span>, 1), <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;$set&quot;</span>, <a class="code" href="../../dd/dee/namespaceformats_1_1bson.html#a63db58ec47961e5e12ca50d7f4d58636" title="Constructs a Document from provided key-value pairs.">MakeDoc</a>(<span class="stringliteral">&quot;x&quot;</span>, 10)));</div>
<div class="line"> </div>
<div class="line">  EXPECT_EQ(1, result.MatchedCount());</div>
<div class="line">  EXPECT_EQ(1, result.ModifiedCount());</div>
<div class="line">  EXPECT_EQ(0, result.UpsertedCount());</div>
<div class="line">  EXPECT_TRUE(result.UpsertedIds().empty());</div>
<div class="line">  EXPECT_TRUE(result.ServerErrors().empty());</div>
<div class="line">  EXPECT_TRUE(result.WriteConcernErrors().empty());</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md188"></a>
Packaging operations</h2>
<p>In cases where the same operation is performed with the same arguments many times, it can be stored into a variable and reused. The finished operation can be passed to the collection method <code>Execute()</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">inline</span> <span class="keyword">const</span> <a class="code" href="../../d0/d55/classstorages_1_1mongo_1_1operations_1_1Find.html" title="Retrieves documents matching the filter.">storages::mongo::operations::Find</a>&amp; Top3ScoresOp() {</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> kGetTop = [] {</div>
<div class="line">    <a class="code" href="../../d0/d55/classstorages_1_1mongo_1_1operations_1_1Find.html" title="Retrieves documents matching the filter.">storages::mongo::operations::Find</a> op({});</div>
<div class="line"> </div>
<div class="line">    op.SetOption(<a class="code" href="../../da/dd2/classstorages_1_1mongo_1_1options_1_1Sort.html" title="Sorts the results.">storages::mongo::options::Sort</a>{{</div>
<div class="line">        <span class="stringliteral">&quot;score&quot;</span>,</div>
<div class="line">        storages::mongo::options::Sort::kDescending,</div>
<div class="line">    }});</div>
<div class="line">    op.SetOption(<a class="code" href="../../d6/d6b/classstorages_1_1mongo_1_1options_1_1Limit.html" title="Specifies the number of documents to request from the server.">storages::mongo::options::Limit</a>{3});</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> op;</div>
<div class="line">  }();</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> kGetTop;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">inline</span> std::string GetWinners(<a class="code" href="../../db/d50/classstorages_1_1mongo_1_1Collection.html" title="MongoDB collection handle, the main way to operate with MongoDB.">storages::mongo::Collection</a>&amp; mongo_coll) {</div>
<div class="line">  std::string result;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keyword">auto</span>&amp; doc : mongo_coll.Execute(Top3ScoresOp())) {</div>
<div class="line">    result += doc[<span class="stringliteral">&quot;name&quot;</span>].As&lt;std::string&gt;(<span class="stringliteral">&quot;&lt;anonymous&gt;&quot;</span>) + <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md189"></a>
BSON</h2>
<p>BSON follows the common formats interface that is described in detail at <a class="el" href="../../db/dd7/md_en_userver_formats.html">Formats (JSON, YAML, BSON, ...)</a>.</p>
<p>Since BSON is a binary format, it is not human readable. Differences in the BSON and JSON formats type systems do not always allow you to perform conversions between them unambiguously. In this regard, we do not provide conversion functions between BSON and text formats by default, but they are available in &lt;<a class="el" href="../../d6/de5/mongo_2include_2userver_2formats_2bson_2serialize_8hpp.html" title="Textual serialization helpers.">userver/formats/bson/serialize.hpp</a>&gt;. These functions are provided without guarantees for the stability of the conversion, and are primarily intended for debugging. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
<a id='page_edit' style="float:left; padding-left: 7pt;" href="#">⚒ Редактировать страницу</a>
<address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
<script type="text/javascript">
const LOWER_CASE_TRANSLITTERATION_MAPPING = {
    "а":"a", "б":"b", "в":"v", "г":"g", "д":"d", "е":"e", "ё":"jo", "ж":"zh",
    "з":"z", "и":"i", "й":"jj", "к":"k", "л":"l", "м":"m", "н":"n", "о":"o",
    "п":"p", "р":"r", "с":"s", "т":"t", "у":"u", "ф":"f", "х":"x", "ц":"c",
    "ч":"ch", "ш":"sh", "щ":"shh", "ъ":"\'", "ы":"y", "ь":"\'", "э":"je",
    "ю":"ju", "я":"ja"
};
const DOXYGEN_DIAMOND_STRING = '◆\u00A0' // ◆&nbsp;
function make_id(raw_id) {
    return raw_id.toLowerCase().split('').map(function (char) {
        return LOWER_CASE_TRANSLITTERATION_MAPPING[char] || char;
    }).join('').replace(/\W/g, '');
}
const html_escape = function () {
    const p = document.createElement('p');
    return function (text) {
        p.textContent = text;
        return p.innerHTML;
    };
}();
function setup_page_edit() {
    let href = window.location.href;
    const idx = href.indexOf('md_ru_');
    if (idx === -1) {
        $('#page_edit').hide();
        return;
    }
    href = href.substring(idx).split('.html')[0];
    href = href.split('#')[0];
    href = href.replace('md_ru_', 'https://wiki.yandex-team.ru/taxi/backend/');
    href = href.replaceAll('_', '/');
    $('#page_edit').attr("href", href + '/.edit');
}
function draw_toc() {
    let headers = $(':header');
    if (headers.length === 0) {
        return;
    }
    let sidenav_content = '<div id="mySidenav" class="sidenav">';
    sidenav_content += '<h2>Table of contents</h2>';
    headers.each(function() {
        let index = parseInt(this.nodeName.substring(1)) - 1;
        const header = $(this);
        let id = header.attr('id');
        if (!id) {
          id = make_id(header.text())
          header.attr('id', id);
        }
        let header_text = header.text()
        if (header_text.startsWith(DOXYGEN_DIAMOND_STRING)) {
            ++index;
            header_text = header_text.substring(DOXYGEN_DIAMOND_STRING.length);
        }
        sidenav_content += ''
          + '<a href="#' + id + '" style="padding-left: ' + index * 15 + 'px">'
          + '•&nbsp;' + html_escape(header_text)
          + '</a>'
        ;
        header.append(' <a class="hoverlink" href="#' + id + '">🔗</a>')
    });
    sidenav_content += '</div>';
    $(sidenav_content).insertAfter('.header');
}
function highlight_code() {
    if (window.location.href.indexOf("pp_source") !== -1
        || window.location.href.indexOf("cpp-example") !== -1) {
        // Header listing is already nicely highlighted by Doxygen
        return;
    }
    hljs.configure({
        tabReplace: '    ' // 4 spaces
    });
    hljs.registerAliases('py', {languageName: 'python'});
    hljs.registerAliases('sh', {languageName: 'shell'});
    hljs.registerAliases('bash', {languageName: 'shell'});
    hljs.registerAliases('yml', {languageName: 'yaml'});
    hljs.registerAliases('plain', {languageName: 'plaintext'});
    hljs.registerAliases('tskv', {languageName: 'plaintext'});
    $(".fragment").each(function() {
        const node = $(this);
        let data = '';
        let language = '';
        let requires_higlighting = true;
        node.children('div.line').each(function(i) {
            line = $(this).text();
            // Doxygen 1.8.11 workaround to remove line numbers.
            // No line numbers added in Doxygen 1.8.13
            line = line.replace(/^ *\d+\xA0/, '');
            if (i === 0) {
                line = line.trimLeft().replace(/^# /, '');
                if (line === 'autodetect') {
                    return true;
                } else if (hljs.getLanguage(line)) {
                    language = line;
                    return true;
                } else {
                    requires_higlighting = false;
                    return false;
                }
            }
            data += line + '\n';
        });
        if (requires_higlighting === false) {
            return;
        }
        if (language !== '') {
            data = hljs.highlight(language, data).value;
        } else {
            data = hljs.highlightAuto(data).value;
        }
        node.replaceWith('<div class="fragment"><pre>' + data + '</pre></div>');
    });
}
function setup_if_landing() {
    if (document.getElementById('landing_logo_id') === null) {
        return false;
    }
    $('#titlearea').hide();
    const main_nav = $('#main-nav')
    main_nav.addClass('main-nav-landing');
    main_nav.append('<hr>');
    $('.header').hide();
    $('body').css('background-color', 'black');
    $('#page_edit').hide();
    return true;
}
function sticky_menu() {
    const main_nav = $('#main-nav');
    const menu_y_position = 94;
    const search_results_window = $('#MSearchResultsWindow');
    var menu_is_sticky = false;
    const stick = function () {
        if ($(this).scrollTop() > menu_y_position) {
            if (menu_is_sticky) return;
            search_results_window.addClass('stickySearchResults');
            main_nav.addClass('stickyHeader');
            menu_is_sticky = true;
        } else {
            if (!menu_is_sticky) return;
            search_results_window.removeClass('stickySearchResults');
            // 'top' property of the results window is computed by Doxygen JS
            // and it may give bad results if the computation is invoked at the
            // middle of the page.
            //
            // Hiding the window. Doxygen will recompute and show it on new
            // user input.
            search_results_window.hide();
            main_nav.removeClass('stickyHeader');
            menu_is_sticky = false;
        }
    };
    stick();  // on page refresh draw the menu on a right position
    $(window).on("scroll", stick);
}
function telegram_channel_language() {
  if (/^ru/.test(navigator.language)) {
    const channel = $('#telegram_channel');
    if (channel) {
      channel.attr('href', 'https://t.me/+AdadhDPVG5xhNWRi');
    }
  }
}
$(function() {
    if (setup_if_landing()) return;
    draw_toc();
    highlight_code();
    setup_page_edit();
    telegram_channel_language();
    sticky_menu();
});
</script>
</body>
</html>
